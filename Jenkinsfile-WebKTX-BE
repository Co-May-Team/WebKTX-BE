pipeline {
	agent any
	environment {
        report = '/var/lib/jenkins/workspace/dev-WebKTX-BE/Email/email-template.html'
    }
    stages {
	    stage ('Load functions') {      // Define the function files will be used
            steps {
                script {
                    emailFunction = load "Email/emailFunction.groovy"
                }
            }
        }
        stage('Build') { 
            steps {
				sh 'mvn install:install-file -Dfile=./jars/VN-time-new-roman.jar -DgroupId=com.webktx.font -DartifactId=VN-time-new-roman -Dversion=1.0 -Dpackaging=jar'
				sh 'mvn clean install'
            }
        } 
		stage('Deploy') { 
            steps {
				sh 'sudo systemctl enable dev-webKTX-BE.service'
				sh 'sudo systemctl stop dev-webKTX-BE'
				sh 'sudo systemctl start dev-webKTX-BE'
				sh 'sudo systemctl status dev-webKTX-BE'
				sh 'sudo rm -rf changelog*'
				sh "sudo cp /var/lib/jenkins/jobs/dev-WebKTX-BE/builds/${env.BUILD_NUMBER}/changelog* /var/lib/jenkins/workspace/dev-WebKTX-BE/"
            }
        }		
	}
	post ('Send e-mail') {          // Stage for send an email
        always {
                script {
                    emailFunction.emailSendingnoattachment("nguyenminhdungtd98@gmail.com")       // Define the emails address should be received the mail
                }
        }
    }


}

